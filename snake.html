<html>
    <head>
        Snake
    </head>
    <body>
        <table id="grid">
        </table>
    </body>


    <script>

        var height = 20;
        var width = 20;


        /*
            Random fruit generation without collision
            Game over collisions:
                hit wall
                hit snake
            Snake as list
                Add to head and remove from tail
        */

        const grid = [];

        // Build grid
        for (var row = 0; row < height; row++) {
            var table = document.getElementById("grid");
            const newRow = table.insertRow()
            newRow.id = row;
            grid[row] = [];
            for (var col = 0; col < width; col++) {
                const cell = newRow.insertCell();
                cell.id = `${row},${col}`;
                cell.classList.add("cell");
                if (col == width - 1) {
                    cell.classList.add("cell-last-col");
                }
                if (row == height - 1) {
                    cell.classList.add("cell-last-row");
                }
                grid[row][col] = document.getElementById(`${row},${col}`);
            }
        }

        const snake = [grid[3][5]];

        snake[0].classList.add("snake");

        grid[5][7].classList.add("fruit");

        document.addEventListener("keydown", function(event) {
            const direction = event.key;
            if (["ArrowUp", "ArrowRight", "ArrowDown", "ArrowLeft"].includes(direction)) {
                var snakeHead = snake[0];
                const snakeHeadCoordinate = [snakeHead.id.split(',')[0], snakeHead.id.split(',')[1]];
                const nextCellCoordinate = calcNextCellCoordinate(snake[0].id, direction);
                if (nextCellCoordinate == -1) {
                    alert("HIT WALL - GAME OVER")
                    return;
                }
                console.log(snakeHeadCoordinate, nextCellCoordinate);
                if (nextCellCoordinate != snakeHead.id) {
                    // Means we moved
                    snakeHead.classList.remove("snake");
                    snakeHead = document.getElementById(nextCellCoordinate);
                    snakeHead.classList.add("snake");
                    snake[0] = grid[nextCellCoordinate[0]][nextCellCoordinate[1]];
                }
                
            }

        });

        var calcNextCellCoordinate = (currentCoordinate, direction) => {
            var row = currentCoordinate.split(',')[0];
            var col = currentCoordinate.split(',')[1];
            switch (direction) {
                case "ArrowUp":
                    if (row == 0) {
                        return -1;
                    }
                    row--;
                    break;
                case "ArrowRight":
                    if (col == width - 1) {
                        return -1;
                    }
                    col++;
                    break;
                case "ArrowDown":
                    if (row == height - 1) {
                        return -1;
                    }
                    row++;
                    break;
                case "ArrowLeft":
                    if (col == 0) {
                        return -1;
                    }
                    col--;
                    break;
            }
            return [row, col];
        };

    </script>

    <style>
        table {
            border-spacing: 0;
            border-collapse: collapse;
        }
        .cell {
            width: 30;
            height: 30;
            border-left: 2px solid black;
            border-top: 2px solid black;
        }
        .cell-last-row {
            border-bottom: 2px solid black;
        }
        .cell-last-col {
            border-right: 2px solid black;
        }
        .fruit {
            background-color: red;
        }
        .snake {
            background-color: green;
        }
    </style>
</html>
