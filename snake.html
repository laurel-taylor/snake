<html>
    <head>
        Snake
    </head>
    <body>
        <table id="grid">
        </table>
    </body>


    <script>
        /*
            // Can't go backwards
            Random fruit generation without collision
            Game over collisions:
                hit wall
                hit snake
            Snake as list
                Add to head and remove from tail
        */

        var height = 20;
        var width = 20;
        const moveEvery = 1000;
        const grid = [];

        const get = (coord) => {
            return document.getElementById(`${coord[0]},${coord[1]}`);
        }

        // Build grid
        for (var row = 0; row < height; row++) {
            var table = document.getElementById("grid");
            const newRow = table.insertRow()
            newRow.id = row;
            grid[row] = [];
            for (var col = 0; col < width; col++) {
                const cell = newRow.insertCell();
                cell.id = `${row},${col}`;
                cell.classList.add("cell");
                if (col == width - 1) {
                    cell.classList.add("cell-last-col");
                }
                if (row == height - 1) {
                    cell.classList.add("cell-last-row");
                }
                grid[row][col] = get([row, col]);
            }
        }


        class Snake {
            constructor(direction) {
                this.direction = direction;
                this.body = [];

                this.addHead(get([2, 9]));
                this.addHead(get([3, 9]));
                this.addHead(get([4, 9]));
                this.addHead(get([5, 9]));
            }

            getHead() {
                if (this.body.lengh == 0) {
                    return undefined;
                }
                return this.body[0];
            }

            addHead(cell) {
                cell.classList.remove('fruit');
                cell.classList.add('snake');
                this.body.unshift(cell)
            }

            removeTail() {
                if (this.body.lengh == 0) {
                    return;
                }

                this.body.pop().classList.remove('snake');
            }
        }

        const snake = new Snake("down");

        const keyToDirection = {
            "ArrowUp": "up",
            "ArrowDown": "down",
            "ArrowLeft": "left",
            "ArrowRight": "right", 
        }

        document.addEventListener("keydown", function(event) {
            const direction = keyToDirection[event.key];
             
            if (direction != undefined) {
                snake.direction = direction
                const nextCell = getNextCell(snake);
                console.log(nextCell)
                if (nextCell == undefined) {
                    alert("GAME OVER")
                } else {
                    if (nextCell.classList.contains("fruit")) {
                        snake.addHead(nextCell);
                    } else {
                        snake.addHead(nextCell);
                        snake.removeTail();
                    }
                }
            }

        });

        var getNextCell = (snake) => {
            const snakeHead = snake.getHead();
            if (snakeHead == undefined) {
                return undefined;
            }

            var row = snakeHead.id.split(',')[0]
            var col = snakeHead.id.split(',')[1]

            switch (snake.direction) {
                case "up":
                    if (row == 0) {
                        return undefined;
                    }
                    row--;
                    break;
                case "right":
                    if (col == width - 1) {
                        return undefined;
                    }
                    col++;
                    break;
                case "down":
                    if (row == height - 1) {
                        return undefined;
                    }
                    row++;
                    break;
                case "left":
                    if (col == 0) {
                        return undefined;
                    }
                    col--;
                    break;
            }
            return get([row, col]);
        };

    </script>

    <style>
        table {
            border-spacing: 0;
            border-collapse: collapse;
        }
        .cell {
            width: 30;
            height: 30;
            border-left: 2px solid black;
            border-top: 2px solid black;
        }
        .cell-last-row {
            border-bottom: 2px solid black;
        }
        .cell-last-col {
            border-right: 2px solid black;
        }
        .fruit {
            background-color: red;
        }
        .snake {
            background-color: green;
        }
    </style>
</html>
